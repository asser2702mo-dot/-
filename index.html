<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-container { position: relative; border: 5px solid #444; border-radius: 15px; overflow: hidden; box-shadow: 0 0 50px rgba(46, 125, 50, 0.5); }
        canvas { background: #1b5e20; display: block; }
        #lobby, #game-over, #shop, #manual, #win-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #lobby { background: radial-gradient(circle, #2e7d32, #000); }
        #shop, #manual { justify-content: flex-start; overflow-y: auto; padding: 20px 0; }
        .btn { background: #f1c40f; color: black; padding: 12px 25px; margin: 8px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; width: 240px; transition: 0.3s; }
        .btn:hover { background: #fff; transform: scale(1.05); }
        .currency-bar { position: absolute; top: 10px; right: 20px; font-size: 20px; font-weight: bold; color: #f1c40f; z-index: 110; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; border: 1px solid #f1c40f; }
        .manual-box { direction: rtl; padding: 30px; text-align: right; max-width: 650px; font-size: 14px; line-height: 1.6; color: #fff; }
        .manual-section { background: rgba(255,255,255,0.07); padding: 12px; border-radius: 10px; margin-bottom: 10px; border-right: 5px solid #f1c40f; }
        .manual-section h3 { color: #f1c40f; margin: 0 0 5px 0; font-size: 16px; }
        #bottom-ui { width: 100%; background: #111; padding: 10px; border-top: 4px solid #f1c40f; display: flex; justify-content: space-around; font-size: 16px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="currency-bar">ğŸ’° <span id="coins-display">0</span> | ğŸ’ <span id="gems-display">0</span></div>

    <div id="game-container">
        <div id="lobby">
            <h1 style="font-size: 35px;">âš½ Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ âš½</h1>
            <button class="btn" onclick="startGame(false)">Ù…Ø¨Ø§Ø±Ø§Ø© Ø¹Ø§Ø¯ÙŠØ© (15 Ù‡Ø¯Ù Ù„Ù„ÙÙˆØ²)</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="startGame(true)">ğŸ’€ Ø§Ù„Ø´Ø¨Ø­ (20 Ù‡Ø¯Ù Ø¨Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…)</button>
            <button class="btn" onclick="openShop()">Ù…ØªØ¬Ø± Ø§Ù„Ø´Ø®ØµÙŠØ§Øª ğŸ›’</button>
            <button class="btn" style="background:#3498db; color:white;" onclick="openManual()">ğŸ“– ÙƒØªÙŠØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</button>
        </div>

        <div id="manual" style="display: none;">
            <div class="manual-box">
                <h2 style="color:#f1c40f; text-align:center;">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
                
                <div class="manual-section">
                    <h3>ğŸ† ÙƒÙŠÙ ØªÙÙˆØ²ØŸ</h3>
                    <p>â€¢ <b>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©:</b> Ø³Ø¬Ù„ 15 Ù‡Ø¯ÙØ§Ù‹ Ù„ØªØ®ØªÙ… Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ·Ø±Ø¯ Ø¹Ù…Ø±Ùˆ.</p>
                    <p>â€¢ <b>ØªØ­Ø¯ÙŠ Ø§Ù„Ø´Ø¨Ø­:</b> Ø³Ø¬Ù„ 20 Ù‡Ø¯ÙØ§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <b>Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…</b> Ø­ØµØ±Ø§Ù‹ Ù„Ù„ÙÙˆØ² Ø¨Ø§Ù„ØªØ§Ø¬ Ø§Ù„Ù…Ù„ÙƒÙŠ.</p>
                </div>

                <div class="manual-section">
                    <h3>ğŸ‘¤ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ§Ø¯ ÙˆÙ‚Ø¯Ø±Ø§ØªÙ‡Ù…</h3>
                    <p>â€¢ <b>Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…:</b> Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯ "Ø§Ù„Ù…Ø®ØªØ±Ù‚" Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙˆÙ‚ÙÙ‡ Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­.</p>
                    <p>â€¢ <b>Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨:</b> ÙŠØ³Ø¬Ù„ 3 Ø£Ù‡Ø¯Ø§Ù ÙÙŠ Ø§Ù„Ù„Ù…Ø³Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© (ÙŠÙˆØµÙ„Ùƒ Ù„Ù„ÙÙˆØ² Ø£Ø³Ø±Ø¹).</p>
                    <p>â€¢ <b>Ø£Ø­Ù…Ø¯ Ø¹ÙÙŠÙÙŠ:</b> "Ø¯Ù…Ø¬" Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠØ±ÙØ¹ Ø£Ø±Ø¨Ø§Ø­Ùƒ Ù„Ù€ 150 ÙƒÙˆÙŠÙ† Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 50.</p>
                    <p>â€¢ <b>Ø·Ù‡:</b> Ø¨Ù„Ù…Ø³Ø© Ù…Ù†Ù‡ØŒ ÙŠØªØ¬Ù…Ø¯ Ø¹Ù…Ø±Ùˆ Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØ© ÙƒØ§Ù…Ù„Ø© ÙÙŠ Ù…ÙƒØ§Ù†Ù‡.</p>
                    <p>â€¢ <b>Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†:</b> Ø£ÙˆÙ„ ÙƒØ±Ø© ÙŠØ´ÙˆØ·Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© "Ø¨Ø±Ù‚ Ø®Ø§Ø·Ù" Ù„Ø§ ØªØµØ¯.</p>
                    <p>â€¢ <b>Ø¨Ø¨Ø§Ø³ÙŠ:</b> ÙØ®! Ù„Ùˆ Ø§Ø´ØªØ±ÙŠØªÙ‡ Ù‡ØªØ¯ÙØ¹ 500 ÙƒÙˆÙŠÙ† ÙˆÙ‡ØªØ®Ø³Ø± Ø¯Ø§ÙŠÙ…Ø§Ù‹.</p>
                </div>

                <div class="manual-section">
                    <h3>ğŸ‘¹ ÙˆØ­ÙˆØ´ Ø§Ù„Ù…Ø±Ù…Ù‰ (Ø¹Ù…Ø±Ùˆ)</h3>
                    <p>â€¢ Ø¹Ù…Ø±Ùˆ ÙŠØªØ·ÙˆØ± ÙƒÙ„ 3 Ø£Ù‡Ø¯Ø§Ù (ÙŠØªØºÙŠØ± Ù„ÙˆÙ†Ù‡ ÙˆØ­Ø¬Ù…Ù‡ ÙˆØ³Ø±Ø¹ØªÙ‡).</p>
                    <p>â€¢ <b>Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­:</b> Ø´ÙØ§Ù ÙˆØ³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹ØŒ ÙŠØµØ¯ Ø£ÙŠ ÙƒØ±Ø© Ø¥Ù„Ø§ ÙƒØ±Ø© Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ….</p>
                </div>
            </div>
            <button class="btn" onclick="closeScreens()">ÙÙ‡Ù…Øª ÙƒÙ„ Ø´ÙŠØ¡!</button>
        </div>

        <div id="win-screen" style="display: none;">
            <h1 style="color:#f1c40f; font-size: 50px;">ğŸ† Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸ†</h1>
            <p id="win-msg" style="font-size: 20px;"></p>
            <button class="btn" onclick="backToLobby()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>

        <div id="shop" style="display: none;">
            <h2 style="color:#f1c40f">Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
            <div class="shop-grid" id="shop-items"></div>
            <button class="btn" onclick="closeScreens()" style="background:#e74c3c; color:white;">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="game-over" style="display: none;">
            <h1 style="color:red;">Ø®Ø³Ø±Øª! Ø¹Ù…Ø±Ùˆ Ø·Ø±Ø¯Ùƒ!</h1>
            <button class="btn" onclick="retryLevel()">Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ ğŸ”„</button>
            <button class="btn" onclick="backToLobby()">Ø§Ù„Ù„ÙˆØ¨ÙŠ ğŸ </button>
        </div>

        <canvas id="gameCanvas" width="750" height="450"></canvas>

        <div id="bottom-ui">
            <div>ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: <span id="score">0</span></div>
            <div>ğŸ‘¹ Ø§Ù„Ø®ØµÙ…: <span id="bossState">Ø¹Ù…Ø±Ùˆ</span></div>
            <div>ğŸ‘¤ Ø§Ù„Ù„Ø§Ø¹Ø¨: <span id="active-char-ui" style="color:#f1c40f">Ø¢Ø³Ø±</span></div>
            <div id="heartContainer">â¤ï¸â¤ï¸â¤ï¸</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let gems = parseInt(localStorage.getItem('gems')) || 0;
        let ownedChars = JSON.parse(localStorage.getItem('ownedChars')) || ['Ø¢Ø³Ø±'];
        let currentChar = localStorage.getItem('currentChar') || 'Ø¢Ø³Ø±';

        const shopItems = [
            { id: 'Ø¢Ø³Ø±', name: 'Ø¢Ø³Ø±', price: 0, type: 'free', ability: '50 ÙƒÙˆÙŠÙ†' },
            { id: 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…', name: 'ğŸ‘‘ Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…', price: 25, type: 'gem', ability: 'Ù‚Ø§Ù‡Ø± Ø§Ù„Ø´Ø¨Ø­' },
            { id: 'Ø¨ÙƒØ¬', name: 'ğŸ‘¹ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨', price: 150, type: 'gem', ability: '3 Ø£Ù‡Ø¯Ø§Ù Ø¨Ø¶Ø±Ø¨Ø©' },
            { id: 'Ø¹ÙÙŠÙÙŠ', name: 'Ø£Ø­Ù…Ø¯ Ø¹ÙÙŠÙÙŠ', price: 20, type: 'gem', ability: '150 ÙƒÙˆÙŠÙ† Ù„Ù„Ø¬ÙˆÙ„' },
            { id: 'Ù†ÙˆØ±', name: 'Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†', price: 30, type: 'gem', ability: 'Ø£ÙˆÙ„ Ø´ÙˆØ·Ø© Ø¨Ø±Ù‚' },
            { id: 'Ø·Ù‡', name: 'Ø·Ù‡', price: 10, type: 'gem', ability: 'ØªØ¬Ù…ÙŠØ¯ Ø¹Ù…Ø±Ùˆ' },
            { id: 'Ø¨Ø¨Ø§Ø³ÙŠ', name: 'Ø¨Ø¨Ø§Ø³ÙŠ', price: -500, type: 'coin', ability: 'ÙØ® Ø§Ù„ÙƒÙˆÙŠÙ†Ø²' }
        ];

        let gameRunning = false; let score = 0; let lives = 3; let bossLevel = 1;
        let isImpossibleMode = false; let message = ""; let messageTimer = 0; 
        let firstShot = true; let frozenTimer = 0; let animationId;

        const goal = { x: 180, y: 50, width: 390, height: 160 };
        let ball = { x: 375, y: 410, radius: 10, shooting: false, targetX: 375, targetY: 410, speed: 0.22 };
        let amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7, color: "#2196f3", name: "Ø¹Ù…Ø±Ùˆ" };

        function saveData() { localStorage.setItem('coins', coins); localStorage.setItem('gems', gems); localStorage.setItem('ownedChars', JSON.stringify(ownedChars)); localStorage.setItem('currentChar', currentChar); }
        function updateCurrency() { document.getElementById('coins-display').innerText = coins; document.getElementById('gems-display').innerText = gems; saveData(); }
        function openShop() { document.getElementById('shop').style.display = 'flex'; renderShop(); }
        function openManual() { document.getElementById('manual').style.display = 'flex'; }
        function closeScreens() { document.getElementById('shop').style.display = 'none'; document.getElementById('manual').style.display = 'none'; }
        
        function renderShop() {
            const container = document.getElementById('shop-items'); container.innerHTML = '';
            shopItems.forEach(char => {
                const isOwned = ownedChars.includes(char.id); const isActive = currentChar === char.id;
                const itemDiv = document.createElement('div'); itemDiv.className = `item ${isActive ? 'active' : ''}`;
                let priceDisplay = char.price < 0 ? `+500ğŸ’°` : `${char.price}${char.type==='gem'?'ğŸ’':'ğŸ’°'}`;
                let btn = isActive ? `<button class="btn" disabled>Ù…Ø¬Ù‡Ø² âœ…</button>` : (isOwned ? `<button class="btn" style="background:#2ecc71" onclick="selectChar('${char.id}')">Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>` : `<button class="btn" onclick="buyChar('${char.id}',${char.price},'${char.type}')">Ø´Ø±Ø§Ø¡ Ø¨Ù€ ${priceDisplay}</button>`);
                itemDiv.innerHTML = `<h3 style='margin:0'>${char.name}</h3><div style='color:#2ecc71; font-size:12px;'>${char.ability}</div>${btn}`;
                container.appendChild(itemDiv);
            });
        }

        function buyChar(id, price, type) {
            if (type === 'gem' && gems >= price) { gems -= price; ownedChars.push(id); }
            else if (type === 'coin') { coins -= price; ownedChars.push(id); }
            else { alert("Ø±ØµÙŠØ¯Ùƒ Ø®Ù„Øµ!"); return; }
            updateCurrency(); renderShop();
        }

        function selectChar(id) { currentChar = id; document.getElementById('active-char-ui').innerText = id; renderShop(); saveData(); }

        function startGame(impossible) {
            cancelAnimationFrame(animationId); isImpossibleMode = impossible;
            document.getElementById('lobby').style.display = 'none'; document.getElementById('game-over').style.display = 'none';
            document.getElementById('win-screen').style.display = 'none';
            score = 0; lives = 3; bossLevel = impossible ? 6 : 1; firstShot = true; frozenTimer = 0;
            resetBall(); resetBoss(); updateUI(); gameRunning = true; animate();
        }

        function backToLobby() { gameRunning = false; document.getElementById('win-screen').style.display = 'none'; document.getElementById('game-over').style.display = 'none'; document.getElementById('lobby').style.display = 'flex'; }
        function retryLevel() { startGame(isImpossibleMode); }
        function resetBall() { ball.shooting = false; ball.x = 375; ball.y = 410; }
        function updateUI() { document.getElementById('score').innerText = score; document.getElementById('bossState').innerText = amr.name; document.getElementById('heartContainer').innerText = "â¤ï¸".repeat(lives); }

        function resetBoss() {
            if (isImpossibleMode) amr = { x: 350, y: 130, width: 50, height: 90, armLen: 140, speed: 18, color: "rgba(255,255,255,0.25)", name: "ğŸ‘» Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­" };
            else amr = { x: 350, y: 130, width: 45 + (bossLevel*5), height: 80 + (bossLevel*2), armLen: 85 + (bossLevel*5), speed: 6 + bossLevel, color: bossLevel==5?"purple":"#2196f3", name: "Ø¹Ù…Ø±Ùˆ Ù„ÙŠÙÙ„ " + bossLevel };
        }

        canvas.addEventListener('mousedown', (e) => {
            if (!ball.shooting && gameRunning) {
                const rect = canvas.getBoundingClientRect();
                ball.targetX = (e.clientX - rect.left) * (canvas.width / rect.width);
                ball.targetY = (e.clientY - rect.top) * (canvas.height / rect.height);
                ball.shooting = true; if (currentChar === 'Ø·Ù‡') frozenTimer = 60;
            }
        });

        function animate() {
            if (!gameRunning) return;
            ctx.fillStyle = "black"; ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = isImpossibleMode ? "#000d1a" : "#1b5e20"; ctx.fillRect(80, 0, 590, 450);
            ctx.strokeStyle = isImpossibleMode ? "cyan" : "white"; ctx.lineWidth = 5; ctx.strokeRect(goal.x, goal.y, goal.width, goal.height);

            if (frozenTimer <= 0) {
                amr.x += amr.speed; if (amr.x < goal.x + 60 || amr.x > goal.x + goal.width - amr.width - 60) amr.speed *= -1;
            } else frozenTimer--;

            ctx.fillStyle = amr.color; ctx.fillRect(amr.x, amr.y, amr.width, amr.height);
            ctx.fillRect(amr.x - amr.armLen, amr.y + 20, amr.armLen, 10); ctx.fillRect(amr.x + amr.width, amr.y + 20, amr.armLen, 10);

            if (ball.shooting) {
                ball.x += (ball.targetX - ball.x) * ball.speed; ball.y += (ball.targetY - ball.y) * ball.speed;
                let hit = ball.x > (amr.x - amr.armLen) && ball.x < (amr.x + amr.width + amr.armLen) && ball.y < (amr.y + amr.height) && ball.y > amr.y;
                
                if (isImpossibleMode && currentChar === 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…') hit = false;
                if (hit && currentChar === 'Ù†ÙˆØ±' && firstShot) hit = false;

                if (hit) {
                    lives--; message = "Ø§Ø¨Ù„Ø¹!"; messageTimer = 40; resetBall(); updateUI();
                    if (lives <= 0) { gameRunning = false; document.getElementById('game-over').style.display='flex'; }
                } else if (ball.y < goal.y + goal.height) {
                    if (ball.x > goal.x && ball.x < goal.x + goal.width) {
                        score += (currentChar === 'Ø¨ÙƒØ¬' ? 3 : 1);
                        coins += (currentChar === 'Ø¹ÙÙŠÙÙŠ' ? 150 : 50);
                        message = "Ø¬ÙˆÙˆÙˆÙˆÙˆÙˆÙ„!"; messageTimer = 40;
                        
                        // ÙØ­Øµ Ø§Ù„ÙÙˆØ²
                        if ((!isImpossibleMode && score >= 15) || (isImpossibleMode && score >= 20)) {
                            gameRunning = false;
                            document.getElementById('win-screen').style.display = 'flex';
                            document.getElementById('win-msg').innerText = isImpossibleMode ? "Ù‡Ø²Ù…Øª Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­ Ø¨Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…!" : "Ø·Ø±Ø¯Øª Ø¹Ù…Ø±Ùˆ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ§Ø¯ Ø¨Ù€ 15 Ù‡Ø¯Ù!";
                        }

                        if (!isImpossibleMode) bossLevel = Math.min(5, Math.floor(score/3) + 1);
                        updateCurrency(); resetBall(); resetBoss(); updateUI();
                    } else { lives--; message = "Ø¨Ø±Ø§ Ø§Ù„Ù…Ø±Ù…Ù‰!"; messageTimer = 40; resetBall(); updateUI(); }
                    firstShot = false;
                }
            }
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2); ctx.fill();
            if (messageTimer > 0) { ctx.fillStyle = "yellow"; ctx.font = "30px Arial"; ctx.textAlign="center"; ctx.fillText(message, 375, 250); messageTimer--; }
            animationId = requestAnimationFrame(animate);
        }
        updateCurrency();
    </script>
</body>
</html>
