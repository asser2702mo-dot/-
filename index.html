<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุณุชุงุฏ ุขุณุฑ ุงูุฏููู - ุงููุณุฎุฉ ุงูุฃุณุทูุฑูุฉ</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-container { position: relative; border: 5px solid #444; border-radius: 15px; overflow: hidden; box-shadow: 0 0 50px rgba(46, 125, 50, 0.5); }
        canvas { background: #1b5e20; display: block; }
        #lobby, #game-over, #shop, #manual { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #lobby { background: radial-gradient(circle, #2e7d32, #000); }
        #shop, #manual { justify-content: flex-start; overflow-y: auto; padding: 20px 0; }
        .btn { background: #f1c40f; color: black; padding: 12px 25px; margin: 8px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; width: 240px; transition: 0.3s; }
        .btn:hover { background: #fff; transform: scale(1.05); }
        .currency-bar { position: absolute; top: 10px; right: 20px; font-size: 20px; font-weight: bold; color: #f1c40f; z-index: 110; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; border: 1px solid #f1c40f; }
        .shop-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 10px; padding: 0 20px 50px 20px; }
        .item { background: #222; padding: 15px; border: 2px solid #444; border-radius: 10px; width: 340px; text-align: right; direction: rtl; }
        .item.active { border-color: #f1c40f; box-shadow: 0 0 10px #f1c40f; }
        .manual-box { direction: rtl; padding: 30px; text-align: right; max-width: 650px; font-size: 14px; line-height: 1.8; color: #fff; }
        .manual-section { background: rgba(255,255,255,0.07); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-right: 5px solid #f1c40f; }
        .manual-section h3 { color: #f1c40f; margin-top: 0; border-bottom: 1px solid #555; padding-bottom: 5px; font-size: 18px; }
        #bottom-ui { width: 100%; background: #111; padding: 10px; border-top: 4px solid #f1c40f; display: flex; justify-content: space-around; font-size: 16px; font-weight: bold; }
        b { color: #f1c40f; }
    </style>
</head>
<body>

    <div class="currency-bar">๐ฐ <span id="coins-display">0</span> | ๐ <span id="gems-display">0</span></div>

    <div id="game-container">
        <div id="lobby">
            <h1 style="font-size: 40px; text-shadow: 2px 2px #000;">โฝ ุงุณุชุงุฏ ุขุณุฑ ุงูุฏููู โฝ</h1>
            <button class="btn" onclick="startGame(false)">ูุจุงุฑุงุฉ ุนุงุฏูุฉ โฝ</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="startGame(true)">๐ ุงูุชุญุฏู ุงููุณุชุญูู ๐</button>
            <button class="btn" onclick="openShop()">ูุชุฌุฑ ุงูุดุฎุตูุงุช ๐</button>
            <button class="btn" style="background:#2ecc71" onclick="exchangeCoins()">ุชุญููู 50๐ฐ ูู 1๐</button>
            <button class="btn" style="background:#3498db; color:white;" onclick="openManual()">ูุชูุจ ุงูุชุนูููุงุช ๐</button>
        </div>

        <div id="shop" style="display: none;">
            <h2 style="color:#f1c40f">ุณูู ุงููุงุนุจูู</h2>
            <div class="shop-grid" id="shop-items"></div>
            <button class="btn" onclick="closeScreens()" style="background:#e74c3c; color:white;">ุฎุฑูุฌ</button>
        </div>

        <div id="manual" style="display: none;">
            <div class="manual-box">
                <h1 style="color:#3498db; text-align:center; text-decoration: underline;">๐ ุงูุฏููู ุงูุดุงูู ููุงุณุชุงุฏ</h1>
                
                <div class="manual-section">
                    <h3>๐น๏ธ ูุธุงู ุงููุนุจ ูุงูุชุญูู</h3>
                    <p>โข ุงููุนุจุฉ ุนุจุงุฑุฉ ุนู ุชุญุฏู ุถุฑุจุงุช ุฌุฒุงุก ุถุฏ <b>ุนูุฑู</b>. ุงุถุบุท ุจุงููุงูุณ (ุฃู ุงููุณ ุงูุดุงุดุฉ) ูุชุณุฏูุฏ ุงููุฑุฉ.</p>
                    <p>โข ูุฏูู <b>3 ูููุจ โค๏ธ</b>ุ ุฅุฐุง ุตุฏ ุนูุฑู ุงููุฑุฉ ุฃู ูู ุชุฏุฎู ุงููุฑููุ ุชููุฏ ููุจุงู ูุชุณูุน ุฌููุฉ ุนูุฑู ุงูุดููุฑุฉ.</p>
                </div>

                <div class="manual-section">
                    <h3>๐ต ุงูุงูุชุตุงุฏ (ุงูููููุฒ ูุงูุฌูุงูุฑ)</h3>
                    <p>โข <b>ุงูููููุฒ:</b> ุงูุฌูู ุงููุงุญุฏ ูููุญู <b>50 ูููู</b> (ุนูููู ูููุญู 150). ุชูุณุชุฎุฏู ูุชุญููููุง ูุฌูุงูุฑ.</p>
                    <p>โข <b>ุงูุฌูุงูุฑ:</b> ูู ุงูุนููุฉ ุงูููููุฉ ูุดุฑุงุก ุงูุฃุจุทุงู ุงูุฃูููุงุก ูู ุงููุชุฌุฑ.</p>
                    <p>โข <b>ุงูุญูุธ:</b> ูุชู ุญูุธ ุฑุตูุฏู ูุดุฎุตูุงุชู ุชููุงุฆูุงู ูู ุงููุชุตูุญุ ูุง ุชููู ูู ุฅุบูุงู ุงูุตูุญุฉ.</p>
                </div>

                <div class="manual-section">
                    <h3>๐ฅ ุฃุณุฑุงุฑ ุงูุดุฎุตูุงุช</h3>
                    <p>โข <b>ุขุณุฑ:</b> ุงูุจุทู ุงูุฃุณุงุณูุ ุณูุงุญู ุฌููุฉ: "ูุง ุนูุฑู ุฏูุงุจ ูุง ุดุญุงุช".</p>
                    <p>โข <b>ุขุณุฑ ุงูุจุฑุงูู:</b> ุฃููู ุดุฎุตูุฉุ ุงููุญูุฏ ุงููุงุฏุฑ ุนูู ููุณ "ุนูุฑู ุงูุดุจุญ" ููุฒููุชู.</p>
                    <p>โข <b>ุงูุซูุงุซู ุงููุฑุนุจ:</b> ูุณุฌู 3 ุฃูุฏุงู ูู ุงูุถุฑุจุฉ ุงููุงุญุฏุฉุ ููุชุงุฒ ูุฑูุน ุงูุณููุฑ ุจุณุฑุนุฉ.</p>
                    <p>โข <b>ุฃุญูุฏ ุนูููู:</b> ูุถุงุนู ุฃุฑุจุงุญู ุงููุงููุฉ 3 ูุฑุงุช (150 ูููู ููุฌูู).</p>
                    <p>โข <b>ููุฑ ุงูุฏูู:</b> ุฃูู ุชุณุฏูุฏุฉ ูู ูู ูู ูุจุงุฑุงุฉ ูู "ุตุงุฑูุฎ ูุฎุชุฑู" ูุง ูููู ุตุฏู.</p>
                    <p>โข <b>ุทู:</b> ูุฌูุฏ ุนูุฑู ูู ููุงูู ููุฏุฉ ุซุงููุฉ ูุงููุฉ ุจูุฌุฑุฏ ุงูุถุบุท ููุดูุท.</p>
                </div>

                <div class="manual-section">
                    <h3>๐น ูุฑุงุญู ุชุทูุฑ ุนูุฑู</h3>
                    <p>ุนูุฑู ูุชุทูุฑ ูู 3 ุฃูุฏุงู ุชุฒูุฏ ูู ููุชู ูุณุฑุนุชู ูุญุฌูู:</p>
                    <p>1. <b>ุฃูู ุงูุชุฑู:</b> ุจุทูุก ุฌุฏุงู | 2. <b>ุขุฎุฑ ุงูุชุฑู:</b> ุณุฑุนุฉ ูุชูุณุทุฉ | 3. <b>ุงูุจุฑุงูู:</b> ุณุฑุนุฉ ุนุงููุฉ ูุฃุฐุฑุน ุฃุทูู | 4. <b>ุงูุชุฑู ุงูุซุงูู:</b> ุญุฑูุฉ ุนุดูุงุฆูุฉ ุตุนุจุฉ | 5. <b>ุงูุซุงููู:</b> ุงููุญุด ุงูููุงุฆู ุงูุณุฑูุน.</p>
                    <p>โข <b>ุนูุฑู ุงูุดุจุญ:</b> ูุธูุฑ ููุท ูู "ุงูููุฏ ุงููุณุชุญูู"ุ ูุง ูููู ูุฃุญุฏ ุชุณุฌูู ูุฏู ููู ุฅูุง <b>ุขุณุฑ ุงูุจุฑุงูู</b>.</p>
                </div>
            </div>
            <button class="btn" onclick="closeScreens()" style="background:#e74c3c; color:white;">ูููุช ูู ุงูุฃุณุฑุงุฑ!</button>
        </div>

        <div id="game-over" style="display: none;">
            <h1 id="over-title">ุงูุชูุช ุงููุจุงุฑุงุฉ!</h1>
            <button class="btn" onclick="retryLevel()">ุฅุนุงุฏุฉ ุงููุญุงููุฉ ๐</button>
            <button class="btn" onclick="backToLobby()" style="background:#e74c3c; color:white;">ุงูููุจู ๐</button>
        </div>

        <canvas id="gameCanvas" width="750" height="450"></canvas>

        <div id="bottom-ui">
            <div>๐ฏ ุงูุฃูุฏุงู: <span id="score">0</span></div>
            <div>๐น ุงูุฎุตู: <span id="bossState">ุนูุฑู</span></div>
            <div>๐ค ุงููุงุนุจ: <span id="active-char-ui" style="color:#f1c40f">ุขุณุฑ</span></div>
            <div id="heartContainer">โค๏ธโค๏ธโค๏ธ</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ุงูุจูุงูุงุช ุงููุญููุธุฉ
        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let gems = parseInt(localStorage.getItem('gems')) || 0;
        let ownedChars = JSON.parse(localStorage.getItem('ownedChars')) || ['ุขุณุฑ'];
        let currentChar = localStorage.getItem('currentChar') || 'ุขุณุฑ';

        const shopItems = [
            { id: 'ุขุณุฑ', name: 'ุขุณุฑ (ุงูุฃุตูู)', price: 0, type: 'free', ability: 'ุงูุฌูู ุจู 50 ูููู', catch: 'ูุง ุนูุฑู ุฏูุงุจ ูุง ุดุญุงุช' },
            { id: 'ุขุณุฑ ุงูุจุฑุงูู', name: '๐ ุขุณุฑ ุงูุจุฑุงูู', price: 25, type: 'gem', ability: 'ูุงูุฑ ุงูุดุจุญ (ุถุฑูุฑู ููุชุญุฏู)', catch: 'ูุง ุนูุฑู ุฏูุงุจ ูุง ุดุญุงุช' },
            { id: 'ุจูุฌ', name: '๐น ุงูุซูุงุซู ุงููุฑุนุจ', price: 150, type: 'gem', ability: '3 ุฃูุฏุงู ูู ุถุฑุจุฉ ูุงุญุฏุฉ', catch: 'ุงูุซูุงุซู ุงููุฑุนุจ ูุตู!' },
            { id: 'ุนูููู', name: 'ุฃุญูุฏ ุนูููู', price: 20, type: 'gem', ability: 'ุงูุฌูู ุจู 150 ูููู', catch: 'ุฃูุช ุฏูุฌ ูุณุทุง' },
            { id: 'ููุฑ', name: 'ููุฑ ุงูุฏูู', price: 30, type: 'gem', ability: 'ุตุงุฑูุฎ ูุฎุชุฑู ูุง ูุตุฏ ุฃูู ูุฑุฉ', catch: 'ูุงููุณ!' },
            { id: 'ุทู', name: 'ุทู', price: 10, type: 'gem', ability: 'ุชุฌููุฏ ุงูุฎุตู ูุคูุชุงู', catch: 'ูุงุดู ูุณุทุง ุญุงุถุฑ' },
            { id: 'ุจุจุงุณู', name: 'ุจุจุงุณู', price: -500, type: 'coin', ability: 'ูุฎ ุงูู 500 ูููู', catch: 'ูุนุฑูุชุด ุงุณุชูู' }
        ];

        let gameRunning = false; let score = 0; let lives = 3; let bossLevel = 1;
        let isImpossibleMode = false; let message = ""; let messageTimer = 0; 
        let messageColor = "#f1c40f"; let firstShot = true; let frozenTimer = 0; let animationId;

        const goal = { x: 180, y: 50, width: 390, height: 160 };
        let ball = { x: 375, y: 410, radius: 10, shooting: false, targetX: 375, targetY: 410, speed: 0.22 };
        let amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7, color: "#2196f3", name: "ุนูุฑู ุฃูู ุงูุชุฑู" };

        function saveData() {
            localStorage.setItem('coins', coins); localStorage.setItem('gems', gems);
            localStorage.setItem('ownedChars', JSON.stringify(ownedChars)); localStorage.setItem('currentChar', currentChar);
        }

        function updateCurrency() {
            document.getElementById('coins-display').innerText = coins;
            document.getElementById('gems-display').innerText = gems;
            saveData();
        }

        function exchangeCoins() {
            if (coins >= 50) { coins -= 50; gems += 1; updateCurrency(); }
            else alert("ูุญุชุงุฌ 50 ูููู!");
        }

        function renderShop() {
            const container = document.getElementById('shop-items');
            container.innerHTML = '';
            shopItems.forEach(char => {
                const isOwned = ownedChars.includes(char.id);
                const isActive = currentChar === char.id;
                const itemDiv = document.createElement('div');
                itemDiv.className = `item ${isActive ? 'active' : ''}`;
                let priceDisplay = char.price < 0 ? `+500๐ฐ` : `${char.price}${char.type==='gem'?'๐':'๐ฐ'}`;
                let btn = isActive ? `<button class="btn" disabled>ูุฌูุฒ โ</button>` : 
                          (isOwned ? `<button class="btn" style="background:#2ecc71" onclick="selectChar('${char.id}')">ุงุณุชุฎุฏุงู</button>` : 
                          `<button class="btn" onclick="buyChar('${char.id}',${char.price},'${char.type}')">ุดุฑุงุก ุจู ${priceDisplay}</button>`);
                itemDiv.innerHTML = `<h3>${char.name}</h3><div style="color:#2ecc71; font-size:12px;">${char.ability}</div>${btn}`;
                container.appendChild(itemDiv);
            });
        }

        function buyChar(id, price, type) {
            if (type === 'gem' && gems >= price) { gems -= price; ownedChars.push(id); }
            else if (type === 'coin') { coins -= price; ownedChars.push(id); }
            else { alert("ุงูุฑุตูุฏ ูุง ูููู!"); return; }
            updateCurrency(); renderShop();
        }

        function selectChar(id) { currentChar = id; document.getElementById('active-char-ui').innerText = (id === 'ุจูุฌ' ? 'ุงูุซูุงุซู ุงููุฑุนุจ' : id); renderShop(); saveData(); }
        function openShop() { document.getElementById('shop').style.display = 'flex'; renderShop(); }
        function openManual() { document.getElementById('manual').style.display = 'flex'; }
        function closeScreens() { document.getElementById('shop').style.display = 'none'; document.getElementById('manual').style.display = 'none'; }

        function startGame(impossible) {
            cancelAnimationFrame(animationId);
            isImpossibleMode = impossible;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            score = 0; lives = 3; bossLevel = impossible ? 6 : 1;
            firstShot = true; frozenTimer = 0;
            resetBall(); resetBoss(); updateUI(); gameRunning = true; animate();
        }

        function backToLobby() { gameRunning = false; document.getElementById('game-over').style.display = 'none'; document.getElementById('lobby').style.display = 'flex'; }
        function retryLevel() { startGame(isImpossibleMode); }
        function resetBall() { ball.shooting = false; ball.x = 375; ball.y = 410; }
        function updateUI() { document.getElementById('score').innerText = score; document.getElementById('bossState').innerText = amr.name; document.getElementById('heartContainer').innerText = "โค๏ธ".repeat(lives); }

        function resetBoss() {
            if (isImpossibleMode) amr = { x: 350, y: 130, width: 50, height: 90, armLen: 140, speed: 18, color: "rgba(255,255,255,0.25)", name: "๐ป ุนูุฑู ุงูุดุจุญ ๐ป" };
            else if (bossLevel === 1) amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7, color: "#2196f3", name: "ุนูุฑู ุฃูู ุงูุชุฑู" };
            else if (bossLevel === 2) amr = { x: 350, y: 130, width: 60, height: 95, armLen: 95, speed: 10, color: "#5d4037", name: "ุนูุฑู ุขุฎุฑ ุงูุชุฑู" };
            else if (bossLevel === 3) amr = { x: 350, y: 130, width: 40, height: 85, armLen: 125, speed: 14, color: "#FFD700", name: "ุจุฑุงูู ุนูุฑู" };
            else if (bossLevel === 4) amr = { x: 350, y: 130, width: 55, height: 90, armLen: 130, speed: 16, color: "#e91e63", name: "ุนูุฑู ุงูุชุฑู ุงูุซุงูู" };
            else if (bossLevel === 5) amr = { x: 350, y: 130, width: 65, height: 100, armLen: 145, speed: 19, color: "#9c27b0", name: "ุนูุฑู ูุณุฎุฉ ุงูุซุงููู" };
        }

        canvas.addEventListener('mousedown', (e) => {
            if (!ball.shooting && gameRunning) {
                const rect = canvas.getBoundingClientRect();
                ball.targetX = (e.clientX - rect.left) * (canvas.width / rect.width);
                ball.targetY = (e.clientY - rect.top) * (canvas.height / rect.height);
                ball.shooting = true;
                if (currentChar === 'ุทู') { frozenTimer = 60; }
            }
        });

        function animate() {
            if (!gameRunning) return;
            ctx.fillStyle = "black"; ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = isImpossibleMode ? "#000d1a" : "#1b5e20"; ctx.fillRect(80, 0, 590, 450);
            ctx.strokeStyle = isImpossibleMode ? "cyan" : "white"; ctx.lineWidth = 6; ctx.strokeRect(goal.x, goal.y, goal.width, goal.height);

            if (frozenTimer > 0) frozenTimer--;
            else {
                let left = goal.x + amr.armLen; let right = goal.x + goal.width - amr.width - amr.armLen;
                amr.x += amr.speed; if (amr.x < left || amr.x > right) amr.speed *= -1;
            }

            ctx.fillStyle = amr.color; ctx.font = "bold 16px Arial"; ctx.textAlign = "center";
            ctx.fillText(amr.name, amr.x + amr.width/2, amr.y - 30);
            ctx.fillRect(amr.x, amr.y+20, amr.width, amr.height-20);
            ctx.beginPath(); ctx.arc(amr.x + amr.width/2, amr.y, 20, 0, Math.PI*2); ctx.fill();
            ctx.fillRect(amr.x - amr.armLen, amr.y+25, amr.armLen, 14); ctx.fillRect(amr.x + amr.width, amr.y+25, amr.armLen, 14);

            ctx.textAlign = "center";
            if (currentChar === 'ุจูุฌ') {
                ctx.fillStyle = "#ff5722"; ctx.font = "bold 13px Arial";
                ctx.fillText("ุฃููู", 375, 335); ctx.fillText("ุนูู ุณููู", 375, 350); ctx.fillText("ุจุงูุณุชูุชุง", 375, 365);
            } else {
                ctx.fillStyle = (currentChar.includes('ุงูุจุฑุงูู')) ? "#FFD700" : "#f1c40f";
                ctx.font = "bold 16px Arial"; ctx.fillText(currentChar, 375, 355);
            }
            ctx.fillStyle = "#ffdbac"; ctx.beginPath(); ctx.arc(375, 380, 15, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = (currentChar === 'ุจูุฌ' || currentChar.includes('ุงูุจุฑุงูู')) ? "#9b59b6" : "#2ecc71";
            ctx.fillRect(357, 395, 36, 40);

            if (ball.shooting) {
                ball.x += (ball.targetX - ball.x) * ball.speed; ball.y += (ball.targetY - ball.y) * ball.speed;
                let hit = ball.x > (amr.x - amr.armLen) && ball.x < (amr.x + amr.width + amr.armLen) && ball.y < (amr.y + amr.height + 20) && ball.y > amr.y - 20;
                
                if (isImpossibleMode && currentChar !== 'ุขุณุฑ ุงูุจุฑุงูู' && ball.y < 250) hit = true;
                if (hit && currentChar === 'ููุฑ' && firstShot) hit = false;
                if (currentChar === 'ุจุจุงุณู' && ball.y < 250) hit = true;

                if (hit) {
                    lives--; message = "ุงุจูุนุ ุชุดูุฒู ุนูุชู!"; messageColor = "#00d2ff";
                    messageTimer = 80; resetBall(); updateUI();
                    if (lives <= 0) { gameRunning = false; saveData(); document.getElementById('game-over').style.display='flex'; }
                } else if (ball.y <= goal.y + goal.height) {
                    if (ball.x > goal.x && ball.x < goal.x + goal.width) {
                        score += (currentChar === 'ุจูุฌ' ? 3 : 1);
                        coins += (currentChar === 'ุนูููู' ? 150 : 50); 
                        updateCurrency();
                        
                        let characterData = shopItems.find(c => c.id === currentChar);
                        message = characterData ? characterData.catch : "ุฌูููู!"; 
                        messageColor = (currentChar.includes('ุขุณุฑ')) ? "#FFD700" : "#f1c40f"; 
                        messageTimer = 70;

                        if (!isImpossibleMode) {
                            let newLvl = Math.min(5, Math.floor(score/3) + 1);
                            if (newLvl > bossLevel) { bossLevel = newLvl; resetBoss(); }
                        }
                    }
                    firstShot = false; resetBall(); updateUI();
                }
            }
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2); ctx.fill();
            if (messageTimer > 0) { ctx.fillStyle = messageColor; ctx.font = "bold 38px Arial"; ctx.fillText(message, 375, 250); messageTimer--; }
            animationId = requestAnimationFrame(animate);
        }
        updateCurrency();
        document.getElementById('active-char-ui').innerText = (currentChar === 'ุจูุฌ' ? 'ุงูุซูุงุซู ุงููุฑุนุจ' : currentChar);
    </script>
</body>
</html>
