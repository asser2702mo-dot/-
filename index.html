<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© (Ø§Ù„Ù…ØµÙ„Ø­Ø©)</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-container { position: relative; border: 5px solid #444; border-radius: 15px; overflow: hidden; box-shadow: 0 0 50px rgba(46, 125, 50, 0.5); }
        canvas { background: #1b5e20; display: block; }
        #lobby, #game-over, #shop, #manual { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #lobby { background: radial-gradient(circle, #2e7d32, #000); }
        #shop, #manual { justify-content: flex-start; overflow-y: auto; padding: 20px 0; }
        .btn { background: #f1c40f; color: black; padding: 12px 25px; margin: 8px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; width: 240px; transition: 0.3s; }
        .btn:hover { background: #fff; transform: scale(1.05); }
        .currency-bar { position: absolute; top: 10px; right: 20px; font-size: 20px; font-weight: bold; color: #f1c40f; z-index: 110; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; border: 1px solid #f1c40f; }
        .shop-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 10px; padding: 0 20px 50px 20px; }
        .item { background: #222; padding: 15px; border: 2px solid #444; border-radius: 10px; width: 340px; text-align: right; direction: rtl; }
        .item.active { border-color: #f1c40f; box-shadow: 0 0 10px #f1c40f; }
        .manual-box { direction: rtl; padding: 30px; text-align: right; max-width: 650px; font-size: 14px; line-height: 1.8; color: #fff; }
        .manual-section { background: rgba(255,255,255,0.07); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-right: 5px solid #f1c40f; }
        #bottom-ui { width: 100%; background: #111; padding: 10px; border-top: 4px solid #f1c40f; display: flex; justify-content: space-around; font-size: 16px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="currency-bar">ğŸ’° <span id="coins-display">0</span> | ğŸ’ <span id="gems-display">0</span></div>

    <div id="game-container">
        <div id="lobby">
            <h1 style="font-size: 40px;">âš½ Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ âš½</h1>
            <button class="btn" onclick="startGame(false)">Ù…Ø¨Ø§Ø±Ø§Ø© Ø¹Ø§Ø¯ÙŠØ© âš½</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="startGame(true)">ğŸ’€ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ ğŸ’€</button>
            <button class="btn" onclick="openShop()">Ù…ØªØ¬Ø± Ø§Ù„Ø´Ø®ØµÙŠØ§Øª ğŸ›’</button>
            <button class="btn" style="background:#2ecc71" onclick="exchangeCoins()">ØªØ­ÙˆÙŠÙ„ 50ğŸ’° Ù„Ù€ 1ğŸ’</button>
            <button class="btn" style="background:#3498db; color:white;" onclick="openManual()">ÙƒØªÙŠØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ğŸ“–</button>
        </div>

        <div id="shop" style="display: none;">
            <h2 style="color:#f1c40f">Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
            <div class="shop-grid" id="shop-items"></div>
            <button class="btn" onclick="closeScreens()" style="background:#e74c3c; color:white;">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="manual" style="display: none;">
            <div class="manual-box">
                <h2 style="color:#f1c40f">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ØµÙ„Ø­</h2>
                <div class="manual-section">
                    <p>â€¢ <b>Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…:</b> Ù‡Ùˆ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ÙˆØ­ÙŠØ¯Ø© Ø§Ù„Ù‚Ø§Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ø®ØªØ±Ø§Ù‚ "Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­".</p>
                    <p>â€¢ Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ø§Ù„Ø´Ø¨Ø­ Ø¨Ø£ÙŠ Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±ØŒ Ø³ÙŠØµØ¯ Ø§Ù„ÙƒØ±Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹.</p>
                </div>
            </div>
            <button class="btn" onclick="closeScreens()">ÙÙ‡Ù…Øª</button>
        </div>

        <div id="game-over" style="display: none;">
            <h1 id="over-title">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!</h1>
            <button class="btn" onclick="retryLevel()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ğŸ”„</button>
            <button class="btn" onclick="backToLobby()" style="background:#e74c3c; color:white;">Ø§Ù„Ù„ÙˆØ¨ÙŠ ğŸ </button>
        </div>

        <canvas id="gameCanvas" width="750" height="450"></canvas>

        <div id="bottom-ui">
            <div>ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: <span id="score">0</span></div>
            <div>ğŸ‘¹ Ø§Ù„Ø®ØµÙ…: <span id="bossState">Ø¹Ù…Ø±Ùˆ</span></div>
            <div>ğŸ‘¤ Ø§Ù„Ù„Ø§Ø¹Ø¨: <span id="active-char-ui" style="color:#f1c40f">Ø¢Ø³Ø±</span></div>
            <div id="heartContainer">â¤ï¸â¤ï¸â¤ï¸</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let gems = parseInt(localStorage.getItem('gems')) || 0;
        let ownedChars = JSON.parse(localStorage.getItem('ownedChars')) || ['Ø¢Ø³Ø±'];
        let currentChar = localStorage.getItem('currentChar') || 'Ø¢Ø³Ø±';

        const shopItems = [
            { id: 'Ø¢Ø³Ø±', name: 'Ø¢Ø³Ø± (Ø§Ù„Ø£ØµÙ„ÙŠ)', price: 0, type: 'free', ability: 'Ø§Ù„Ø¬ÙˆÙ„ Ø¨Ù€ 50 ÙƒÙˆÙŠÙ†', catch: 'ÙŠØ§ Ø¹Ù…Ø±Ùˆ Ø¯ÙŠØ§Ø¨ ÙŠØ§ Ø´Ø­Ø§Øª' },
            { id: 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…', name: 'ğŸ‘‘ Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…', price: 25, type: 'gem', ability: 'Ù‚Ø§Ù‡Ø± Ø§Ù„Ø´Ø¨Ø­ (Ø§Ù„Ù…Ø®ØªØ±Ù‚)', catch: 'ÙŠØ§ Ø¹Ù…Ø±Ùˆ Ø¯ÙŠØ§Ø¨ ÙŠØ§ Ø´Ø­Ø§Øª' },
            { id: 'Ø¨ÙƒØ¬', name: 'ğŸ‘¹ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨', price: 150, type: 'gem', ability: '3 Ø£Ù‡Ø¯Ø§Ù ÙÙŠ Ø¶Ø±Ø¨Ø© ÙˆØ§Ø­Ø¯Ø©', catch: 'Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨ ÙˆØµÙ„!' },
            { id: 'Ø¹ÙÙŠÙÙŠ', name: 'Ø£Ø­Ù…Ø¯ Ø¹ÙÙŠÙÙŠ', price: 20, type: 'gem', ability: 'Ø§Ù„Ø¬ÙˆÙ„ Ø¨Ù€ 150 ÙƒÙˆÙŠÙ†', catch: 'Ø£Ù†Øª Ø¯Ù…Ø¬ ÙŠØ³Ø·Ø§' },
            { id: 'Ù†ÙˆØ±', name: 'Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†', price: 30, type: 'gem', ability: 'ØµØ§Ø±ÙˆØ® Ù…Ø®ØªØ±Ù‚ Ù„Ø§ ÙŠØµØ¯ Ø£ÙˆÙ„ Ù…Ø±Ø©', catch: 'ÙØ§Ù…ÙˆØ³!' }
        ];

        let gameRunning = false, score = 0, lives = 3, bossLevel = 1, isImpossibleMode = false;
        let message = "", messageTimer = 0, messageColor = "#f1c40f", firstShot = true;
        const goal = { x: 180, y: 50, width: 390, height: 160 };
        let ball = { x: 375, y: 410, radius: 10, shooting: false, targetX: 375, targetY: 410, speed: 0.22 };
        let amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7, color: "#2196f3", name: "Ø¹Ù…Ø±Ùˆ" };

        function saveData() { localStorage.setItem('coins', coins); localStorage.setItem('gems', gems); localStorage.setItem('ownedChars', JSON.stringify(ownedChars)); localStorage.setItem('currentChar', currentChar); }
        function updateCurrency() { document.getElementById('coins-display').innerText = coins; document.getElementById('gems-display').innerText = gems; saveData(); }
        function exchangeCoins() { if (coins >= 50) { coins -= 50; gems += 1; updateCurrency(); } else alert("Ù…Ø­ØªØ§Ø¬ 50 ÙƒÙˆÙŠÙ†!"); }
        function openShop() { document.getElementById('shop').style.display = 'flex'; renderShop(); }
        function closeScreens() { document.getElementById('shop').style.display = 'none'; document.getElementById('manual').style.display = 'none'; }
        function openManual() { document.getElementById('manual').style.display = 'flex'; }
        
        function renderShop() {
            const container = document.getElementById('shop-items');
            container.innerHTML = '';
            shopItems.forEach(char => {
                const isOwned = ownedChars.includes(char.id);
                const isActive = currentChar === char.id;
                const itemDiv = document.createElement('div');
                itemDiv.className = `item ${isActive ? 'active' : ''}`;
                let btn = isActive ? `<button class="btn" disabled>Ù…Ø¬Ù‡Ø² âœ…</button>` : 
                          (isOwned ? `<button class="btn" style="background:#2ecc71" onclick="selectChar('${char.id}')">Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>` : 
                          `<button class="btn" onclick="buyChar('${char.id}',${char.price},'${char.type}')">Ø´Ø±Ø§Ø¡ Ø¨Ù€ ${char.price}${char.type==='gem'?'ğŸ’':'ğŸ’°'}</button>`);
                itemDiv.innerHTML = `<h3>${char.name}</h3><p>${char.ability}</p>${btn}`;
                container.appendChild(itemDiv);
            });
        }

        function buyChar(id, price, type) {
            if (gems >= price) { gems -= price; ownedChars.push(id); updateCurrency(); renderShop(); } 
            else alert("Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø§ ÙŠÙƒÙÙŠ!");
        }

        function selectChar(id) { currentChar = id; document.getElementById('active-char-ui').innerText = id; renderShop(); saveData(); }

        function startGame(impossible) {
            isImpossibleMode = impossible;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            score = 0; lives = 3; bossLevel = impossible ? 6 : 1;
            resetBall(); resetBoss(); updateUI(); gameRunning = true; animate();
        }

        function backToLobby() { gameRunning = false; document.getElementById('lobby').style.display = 'flex'; document.getElementById('game-over').style.display = 'none'; }
        function retryLevel() { startGame(isImpossibleMode); }
        function resetBall() { ball.shooting = false; ball.x = 375; ball.y = 410; }
        function updateUI() { document.getElementById('score').innerText = score; document.getElementById('bossState').innerText = amr.name; document.getElementById('heartContainer').innerText = "â¤ï¸".repeat(lives); }

        function resetBoss() {
            if (isImpossibleMode) amr = { x: 350, y: 130, width: 50, height: 90, armLen: 140, speed: 18, color: "rgba(255,255,255,0.25)", name: "ğŸ‘» Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­ ğŸ‘»" };
            else amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7 + (bossLevel*2), color: "#2196f3", name: "Ø¹Ù…Ø±Ùˆ Ù„ÙŠÙÙ„ " + bossLevel };
        }

        canvas.addEventListener('mousedown', (e) => {
            if (!ball.shooting && gameRunning) {
                const rect = canvas.getBoundingClientRect();
                ball.targetX = (e.clientX - rect.left) * (canvas.width / rect.width);
                ball.targetY = (e.clientY - rect.top) * (canvas.height / rect.height);
                ball.shooting = true;
            }
        });

        function animate() {
            if (!gameRunning) return;
            ctx.fillStyle = "black"; ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = isImpossibleMode ? "#000d1a" : "#1b5e20"; ctx.fillRect(80, 0, 590, 450);
            ctx.strokeStyle = "white"; ctx.lineWidth = 5; ctx.strokeRect(goal.x, goal.y, goal.width, goal.height);

            // ØªØ­Ø±ÙŠÙƒ Ø¹Ù…Ø±Ùˆ
            amr.x += amr.speed;
            if (amr.x < goal.x + 50 || amr.x > goal.x + goal.width - 50 - amr.width) amr.speed *= -1;

            // Ø±Ø³Ù… Ø¹Ù…Ø±Ùˆ
            ctx.fillStyle = amr.color;
            ctx.fillRect(amr.x, amr.y, amr.width, amr.height);
            ctx.fillRect(amr.x - amr.armLen, amr.y + 20, amr.armLen, 10);
            ctx.fillRect(amr.x + amr.width, amr.y + 20, amr.armLen, 10);

            if (ball.shooting) {
                ball.x += (ball.targetX - ball.x) * ball.speed;
                ball.y += (ball.targetY - ball.y) * ball.speed;

                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù… Ù‡Ù†Ø§: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØµØ§Ø¯Ù…
                let isHit = ball.x > (amr.x - amr.armLen) && ball.x < (amr.x + amr.width + amr.armLen) && ball.y < (amr.y + amr.height) && ball.y > amr.y;
                
                // Ù„Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ… ÙˆØ§Ù„Ø®ØµÙ… Ù‡Ùˆ Ø§Ù„Ø´Ø¨Ø­ØŒ Ø§Ù„ØºÙŠ Ø§Ù„ØªØµØ§Ø¯Ù… (Ø®Ù„ÙŠÙ‡ ÙŠØ³Ø¬Ù„)
                if (isImpossibleMode && currentChar === 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…') {
                    isHit = false; 
                }

                if (isHit) {
                    lives--; message = "ØµØ¯Ù‡Ø§ Ø¹Ù…Ø±Ùˆ!"; messageColor = "red"; messageTimer = 50;
                    resetBall(); updateUI();
                    if (lives <= 0) { gameRunning = false; document.getElementById('game-over').style.display='flex'; }
                } else if (ball.y < goal.y + goal.height) {
                    if (ball.x > goal.x && ball.x < goal.x + goal.width) {
                        score += (currentChar === 'Ø¨ÙƒØ¬' ? 3 : 1);
                        coins += (currentChar === 'Ø¹ÙÙŠÙÙŠ' ? 150 : 50);
                        message = "Ø¬ÙˆÙˆÙˆÙˆÙˆÙˆÙˆÙ„!"; messageColor = "#f1c40f"; messageTimer = 50;
                        if (!isImpossibleMode) bossLevel = Math.floor(score/3) + 1;
                        updateCurrency(); resetBall(); resetBoss(); updateUI();
                    } else {
                        lives--; message = "Ø¨Ø±Ø§ Ø§Ù„Ù…Ø±Ù…Ù‰!"; messageColor = "red"; messageTimer = 50;
                        resetBall(); updateUI();
                    }
                }
            }

            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2); ctx.fill();
            if (messageTimer > 0) { ctx.fillStyle = messageColor; ctx.font = "bold 40px Arial"; ctx.textAlign="center"; ctx.fillText(message, 375, 250); messageTimer--; }
            requestAnimationFrame(animate);
        }

        updateCurrency();
    </script>
</body>
</html>
