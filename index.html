<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ - Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-container { position: relative; border: 5px solid #444; border-radius: 15px; overflow: hidden; box-shadow: 0 0 50px rgba(46, 125, 50, 0.5); }
        canvas { background: #1b5e20; display: block; }
        #lobby, #game-over, #shop, #manual { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #lobby { background: radial-gradient(circle, #2e7d32, #000); }
        #shop, #manual { justify-content: flex-start; overflow-y: auto; padding: 20px 0; }
        .btn { background: #f1c40f; color: black; padding: 12px 25px; margin: 8px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; width: 240px; transition: 0.3s; }
        .btn:hover { background: #fff; transform: scale(1.05); }
        .currency-bar { position: absolute; top: 10px; right: 20px; font-size: 20px; font-weight: bold; color: #f1c40f; z-index: 110; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; border: 1px solid #f1c40f; }
        .shop-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 10px; padding: 0 20px 50px 20px; }
        .item { background: #222; padding: 15px; border: 2px solid #444; border-radius: 10px; width: 320px; text-align: right; direction: rtl; }
        .item.active { border-color: #f1c40f; box-shadow: 0 0 10px #f1c40f; }
        .manual-box { direction: rtl; padding: 30px; text-align: right; max-width: 650px; font-size: 15px; line-height: 1.8; color: #eee; }
        .manual-section { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-right: 4px solid #f1c40f; }
        .manual-section h3 { color: #f1c40f; margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 5px; }
        #bottom-ui { width: 100%; background: #111; padding: 10px; border-top: 4px solid #f1c40f; display: flex; justify-content: space-around; font-size: 16px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="currency-bar">ğŸ’° <span id="coins-display">0</span> | ğŸ’ <span id="gems-display">0</span></div>

    <div id="game-container">
        <div id="lobby">
            <h1 style="font-size: 40px;">âš½ Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ âš½</h1>
            <button class="btn" onclick="startGame(false)">Ù…Ø¨Ø§Ø±Ø§Ø© Ø¹Ø§Ø¯ÙŠØ© âš½</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="startGame(true)">ğŸ’€ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ ğŸ’€</button>
            <button class="btn" onclick="openShop()">Ù…ØªØ¬Ø± Ø§Ù„Ø´Ø®ØµÙŠØ§Øª ğŸ›’</button>
            <button class="btn" style="background:#2ecc71" onclick="exchangeCoins()">ØªØ­ÙˆÙŠÙ„ 50ğŸ’° Ù„Ù€ 1ğŸ’</button>
            <button class="btn" style="background:#3498db; color:white;" onclick="openManual()">ÙƒØªÙŠØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ğŸ“–</button>
        </div>

        <div id="shop" style="display: none;">
            <h2 style="color:#f1c40f">Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
            <div class="shop-grid" id="shop-items"></div>
            <button class="btn" onclick="closeScreens()" style="background:#e74c3c; color:white;">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="manual" style="display: none;">
            <div class="manual-box">
                <h1 style="color:#3498db; text-align:center;">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ§Ø¯ Ø¢Ø³Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ</h1>
                
                <div class="manual-section">
                    <h3>ğŸ® Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h3>
                    <p>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ù…ÙˆØ§Ø¬Ù‡Ø© Ø¶Ø±Ø¨Ø§Øª Ø¬Ø²Ø§Ø¡ Ø¶Ø¯ "Ø¹Ù…Ø±Ùˆ". Ø§Ø¶ØºØ· ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ù…Ù‰ Ù„ØªØ³Ø¯ÙŠØ¯ Ø§Ù„ÙƒØ±Ø©. Ù‡Ø¯ÙÙƒ Ù‡Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ù‚Ø¨Ù„ Ø£Ù† ØªÙÙ‚Ø¯ Ù‚Ù„ÙˆØ¨Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«Ø© â¤ï¸.</p>
                </div>

                <div class="manual-section">
                    <h3>ğŸ‘¤ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ÙˆØ§Ù„Ù‚Ø¯Ø±Ø§Øª</h3>
                    <p>â€¢ <b>Ø¢Ø³Ø±:</b> Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØŒ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠÙ‚ÙˆÙ„: "ÙŠØ§ Ø¹Ù…Ø±Ùˆ Ø¯ÙŠØ§Ø¨ ÙŠØ§ Ø´Ø­Ø§Øª".</p>
                    <p>â€¢ <b>Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…:</b> Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ù‚ÙˆÙ‰ØŒ ÙˆØ§Ù„ÙˆØ­ÙŠØ¯Ø© Ø§Ù„ØªÙŠ ØªØ³ØªØ·ÙŠØ¹ Ù‡Ø²ÙŠÙ…Ø© Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­.</p>
                    <p>â€¢ <b>Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨:</b> ÙŠØ¶Ù… (Ø£Ù†Ù…ÙŠØŒ Ø¹Ù…Ù„ Ø³ÙÙ„ÙŠØŒ Ø¨Ø§ÙƒØ³ØªÙˆØªØ§) ÙˆØ§Ù„Ù‡Ø¯Ù Ø§Ù„ÙˆØ§Ø­Ø¯ Ù…Ø¹Ù‡Ù… ÙŠÙØ­Ø³Ø¨ Ø¨Ù€ 3 Ø£Ù‡Ø¯Ø§Ù ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø©.</p>
                    <p>â€¢ <b>Ø£Ø­Ù…Ø¯ Ø¹ÙÙŠÙÙŠ:</b> Ø®Ø¨ÙŠØ± Ø§Ù„Ù…Ø§Ù„ØŒ ÙŠÙ…Ù†Ø­Ùƒ 150 ÙƒÙˆÙŠÙ† Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 50 Ø¹Ù†Ø¯ ÙƒÙ„ Ù‡Ø¯Ù.</p>
                    <p>â€¢ <b>Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†:</b> ÙŠØªÙ…ÙŠØ² "Ø¨Ø§Ù„ØµØ§Ø±ÙˆØ®"ØŒ Ø£ÙˆÙ„ Ø¶Ø±Ø¨Ø© ÙÙŠ ÙƒÙ„ Ù…Ø¨Ø§Ø±Ø§Ø© ØªØ®ØªØ±Ù‚ ÙŠØ¯ Ø¹Ù…Ø±Ùˆ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
                    <p>â€¢ <b>Ø·Ù‡:</b> ÙŠØ¬Ù…Ø¯ Ø¹Ù…Ø±Ùˆ Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ø¨Ù…Ø¬Ø±Ø¯ Ù„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.</p>
                </div>

                <div class="manual-section">
                    <h3>ğŸ‘¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ø¹Ù…Ø±Ùˆ (Ø§Ù„Ø®ØµÙ…)</h3>
                    <p>ÙŠØªØ·ÙˆØ± Ø¹Ù…Ø±Ùˆ ÙƒÙ„ 3 Ø£Ù‡Ø¯Ø§Ù Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØªØ§Ù„ÙŠ:</p>
                    <p>1. Ø£ÙˆÙ„ Ø§Ù„ØªØ±Ù… (Ø¨Ø·ÙŠØ¡) â®• 2. Ø¢Ø®Ø± Ø§Ù„ØªØ±Ù… (Ø³Ø±ÙŠØ¹) â®• 3. Ø§Ù„Ø¨Ø±Ø§ÙŠÙ… (Ø°ÙƒÙŠ) â®• 4. Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø´Ø¯ÙŠØ¯) â®• 5. Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ (Ø£Ø³Ø·ÙˆØ±ÙŠ).</p>
                    <p>6. <b>Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­:</b> Ù…ÙˆØ¬ÙˆØ¯ ÙÙ‚Ø· ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ØŒ Ø¬Ø³Ù…Ù‡ Ø´ÙØ§Ù ÙˆÙ„Ø§ ØªÙ„Ù…Ø³Ù‡ Ø§Ù„ÙƒØ±Ø© Ø¥Ù„Ø§ Ù…Ù† Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ….</p>
                </div>

                <div class="manual-section">
                    <h3>ğŸ’° Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Øª</h3>
                    <p>â€¢ ØªØ³Ø¬ÙŠÙ„ Ù‡Ø¯Ù Ø¹Ø§Ø¯ÙŠ = <b>50 ÙƒÙˆÙŠÙ†</b>.</p>
                    <p>â€¢ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒÙˆÙŠÙ†Ø² Ù„Ø¬ÙˆØ§Ù‡Ø± Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ (ÙƒÙ„ 50 ÙƒÙˆÙŠÙ† Ø¨Ù€ 1 Ø¬ÙˆÙ‡Ø±Ø©).</p>
                    <p>â€¢ Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ­ÙØ¸ ØªÙ‚Ø¯Ù…Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹Ø› Ø¹Ù…Ù„Ø§ØªÙƒ ÙˆØ´Ø®ØµÙŠØ§ØªÙƒ Ù„Ù† ØªØ¶ÙŠØ¹ Ø£Ø¨Ø¯Ø§Ù‹.</p>
                </div>
            </div>
            <button class="btn" onclick="closeScreens()" style="background:#e74c3c; color:white;">ÙÙ‡Ù…ØªØŒ Ù„Ù†Ø¨Ø¯Ø£!</button>
        </div>

        <div id="game-over" style="display: none;">
            <h1 id="over-title">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!</h1>
            <button class="btn" onclick="retryLevel()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ğŸ”„</button>
            <button class="btn" onclick="backToLobby()" style="background:#e74c3c; color:white;">Ø§Ù„Ù„ÙˆØ¨ÙŠ ğŸ </button>
        </div>

        <canvas id="gameCanvas" width="750" height="450"></canvas>

        <div id="bottom-ui">
            <div>ğŸ¯: <span id="score">0</span></div>
            <div>ğŸ‘¹: <span id="bossState">Ø¹Ù…Ø±Ùˆ</span></div>
            <div>ğŸ‘¤: <span id="active-char-ui" style="color:#f1c40f">Ø¢Ø³Ø±</span></div>
            <div id="heartContainer">â¤ï¸â¤ï¸â¤ï¸</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let gems = parseInt(localStorage.getItem('gems')) || 0;
        let ownedChars = JSON.parse(localStorage.getItem('ownedChars')) || ['Ø¢Ø³Ø±'];
        let currentChar = localStorage.getItem('currentChar') || 'Ø¢Ø³Ø±';

        const shopItems = [
            { id: 'Ø¢Ø³Ø±', name: 'Ø¢Ø³Ø± (Ø§Ù„Ø£ØµÙ„ÙŠ)', price: 0, type: 'free', ability: 'Ø§Ù„Ø¬ÙˆÙ„ Ø¨Ù€ 50 ÙƒÙˆÙŠÙ†', catch: 'ÙŠØ§ Ø¹Ù…Ø±Ùˆ Ø¯ÙŠØ§Ø¨ ÙŠØ§ Ø´Ø­Ø§Øª' },
            { id: 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…', name: 'ğŸ‘‘ Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…', price: 25, type: 'gem', ability: 'Ù‚Ø§Ù‡Ø± Ø§Ù„Ø´Ø¨Ø­ (Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ØªØ­Ø¯ÙŠ)', catch: 'ÙŠØ§ Ø¹Ù…Ø±Ùˆ Ø¯ÙŠØ§Ø¨ ÙŠØ§ Ø´Ø­Ø§Øª' },
            { id: 'Ø¨ÙƒØ¬', name: 'ğŸ‘¹ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨', price: 150, type: 'gem', ability: 'Ø£Ù†Ù…ÙŠØŒ Ø¹Ù…Ù„ Ø³ÙÙ„ÙŠØŒ Ø¨Ø§ÙƒØ³ØªÙˆØªØ§', catch: 'Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨ ÙˆØµÙ„!' },
            { id: 'Ø¹ÙÙŠÙÙŠ', name: 'Ø£Ø­Ù…Ø¯ Ø¹ÙÙŠÙÙŠ', price: 20, type: 'gem', ability: 'ÙÙ„ÙˆØ³ x3 (150 Ù„Ù„Ø¬ÙˆÙ„)', catch: 'Ø£Ù†Øª Ø¯Ù…Ø¬ ÙŠØ³Ø·Ø§' },
            { id: 'Ù†ÙˆØ±', name: 'Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†', price: 30, type: 'gem', ability: 'ØµØ§Ø±ÙˆØ® Ù…Ø®ØªØ±Ù‚ Ø£ÙˆÙ„ Ù…Ø±Ø©', catch: 'ÙØ§Ù…ÙˆØ³!' },
            { id: 'Ø·Ù‡', name: 'Ø·Ù‡', price: 10, type: 'gem', ability: 'ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø®ØµÙ… Ù…Ø¤Ù‚ØªØ§Ù‹', catch: 'Ù…Ø§Ø´ÙŠ ÙŠØ³Ø·Ø§ Ø­Ø§Ø¶Ø±' },
            { id: 'Ø¨Ø¨Ø§Ø³ÙŠ', name: 'Ø¨Ø¨Ø§Ø³ÙŠ', price: -500, type: 'coin', ability: 'ÙØ® Ø§Ù„Ù€ 500 ÙƒÙˆÙŠÙ†', catch: 'Ù…Ø¹Ø±ÙØªØ´ Ø§Ø³ØªÙ„Ù…' }
        ];

        let gameRunning = false; let score = 0; let lives = 3; let bossLevel = 1;
        let isImpossibleMode = false; let message = ""; let messageTimer = 0; 
        let messageColor = "#f1c40f"; let firstShot = true; let frozenTimer = 0; let animationId;

        const goal = { x: 180, y: 50, width: 390, height: 160 };
        let ball = { x: 375, y: 410, radius: 10, shooting: false, targetX: 375, targetY: 410, speed: 0.22 };
        let amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7, color: "#2196f3", name: "Ø¹Ù…Ø±Ùˆ Ø£ÙˆÙ„ Ø§Ù„ØªØ±Ù…" };

        function saveData() {
            localStorage.setItem('coins', coins); localStorage.setItem('gems', gems);
            localStorage.setItem('ownedChars', JSON.stringify(ownedChars)); localStorage.setItem('currentChar', currentChar);
        }

        function updateCurrency() {
            document.getElementById('coins-display').innerText = coins;
            document.getElementById('gems-display').innerText = gems;
            saveData();
        }

        function exchangeCoins() {
            if (coins >= 50) { coins -= 50; gems += 1; updateCurrency(); }
            else alert("Ù…Ø­ØªØ§Ø¬ 50 ÙƒÙˆÙŠÙ†!");
        }

        function renderShop() {
            const container = document.getElementById('shop-items');
            container.innerHTML = '';
            shopItems.forEach(char => {
                const isOwned = ownedChars.includes(char.id);
                const isActive = currentChar === char.id;
                const itemDiv = document.createElement('div');
                itemDiv.className = `item ${isActive ? 'active' : ''}`;
                let priceDisplay = char.price < 0 ? `+500ğŸ’°` : `${char.price}${char.type==='gem'?'ğŸ’':'ğŸ’°'}`;
                let btn = isActive ? `<button class="btn" disabled>Ù…Ø¬Ù‡Ø² âœ…</button>` : 
                          (isOwned ? `<button class="btn" style="background:#2ecc71" onclick="selectChar('${char.id}')">Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>` : 
                          `<button class="btn" onclick="buyChar('${char.id}',${char.price},'${char.type}')">Ø´Ø±Ø§Ø¡ Ø¨Ù€ ${priceDisplay}</button>`);
                itemDiv.innerHTML = `<h3>${char.name}</h3><div style="color:#2ecc71; font-size:12px;">${char.ability}</div>${btn}`;
                container.appendChild(itemDiv);
            });
        }

        function buyChar(id, price, type) {
            if (type === 'gem' && gems >= price) { gems -= price; ownedChars.push(id); }
            else if (type === 'coin') { coins -= price; ownedChars.push(id); }
            else { alert("Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø§ ÙŠÙƒÙÙŠ!"); return; }
            updateCurrency(); renderShop();
        }

        function selectChar(id) { currentChar = id; document.getElementById('active-char-ui').innerText = (id === 'Ø¨ÙƒØ¬' ? 'Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨' : id); renderShop(); saveData(); }
        function openShop() { document.getElementById('shop').style.display = 'flex'; renderShop(); }
        function openManual() { document.getElementById('manual').style.display = 'flex'; }
        function closeScreens() { document.getElementById('shop').style.display = 'none'; document.getElementById('manual').style.display = 'none'; }

        function startGame(impossible) {
            cancelAnimationFrame(animationId);
            isImpossibleMode = impossible;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            score = 0; lives = 3; bossLevel = impossible ? 6 : 1;
            firstShot = true; frozenTimer = 0;
            resetBall(); resetBoss(); updateUI(); gameRunning = true; animate();
        }

        function backToLobby() { gameRunning = false; document.getElementById('game-over').style.display = 'none'; document.getElementById('lobby').style.display = 'flex'; }
        function retryLevel() { startGame(isImpossibleMode); }
        function resetBall() { ball.shooting = false; ball.x = 375; ball.y = 410; }
        function updateUI() { document.getElementById('score').innerText = score; document.getElementById('bossState').innerText = amr.name; document.getElementById('heartContainer').innerText = "â¤ï¸".repeat(lives); }

        function resetBoss() {
            if (isImpossibleMode) amr = { x: 350, y: 130, width: 50, height: 90, armLen: 140, speed: 18, color: "rgba(255,255,255,0.25)", name: "ğŸ‘» Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø´Ø¨Ø­ ğŸ‘»" };
            else if (bossLevel === 1) amr = { x: 350, y: 130, width: 45, height: 80, armLen: 85, speed: 7, color: "#2196f3", name: "Ø¹Ù…Ø±Ùˆ Ø£ÙˆÙ„ Ø§Ù„ØªØ±Ù…" };
            else if (bossLevel === 2) amr = { x: 350, y: 130, width: 60, height: 95, armLen: 95, speed: 10, color: "#5d4037", name: "Ø¹Ù…Ø±Ùˆ Ø¢Ø®Ø± Ø§Ù„ØªØ±Ù…" };
            else if (bossLevel === 3) amr = { x: 350, y: 130, width: 40, height: 85, armLen: 125, speed: 14, color: "#FFD700", name: "Ø¨Ø±Ø§ÙŠÙ… Ø¹Ù…Ø±Ùˆ" };
            else if (bossLevel === 4) amr = { x: 350, y: 130, width: 55, height: 90, armLen: 130, speed: 16, color: "#e91e63", name: "Ø¹Ù…Ø±Ùˆ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ" };
            else if (bossLevel === 5) amr = { x: 350, y: 130, width: 65, height: 100, armLen: 145, speed: 19, color: "#9c27b0", name: "Ø¹Ù…Ø±Ùˆ Ù†Ø³Ø®Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ" };
        }

        canvas.addEventListener('mousedown', (e) => {
            if (!ball.shooting && gameRunning) {
                const rect = canvas.getBoundingClientRect();
                ball.targetX = (e.clientX - rect.left) * (canvas.width / rect.width);
                ball.targetY = (e.clientY - rect.top) * (canvas.height / rect.height);
                ball.shooting = true;
                if (currentChar === 'Ø·Ù‡') { frozenTimer = 60; message = "Ù…Ø§Ø´ÙŠ ÙŠØ³Ø·Ø§ Ø­Ø§Ø¶Ø±"; messageTimer = 30; }
            }
        });

        function animate() {
            if (!gameRunning) return;
            ctx.fillStyle = "black"; ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = isImpossibleMode ? "#000d1a" : "#1b5e20"; ctx.fillRect(80, 0, 590, 450);
            ctx.strokeStyle = isImpossibleMode ? "cyan" : "white"; ctx.lineWidth = 6; ctx.strokeRect(goal.x, goal.y, goal.width, goal.height);

            if (frozenTimer > 0) frozenTimer--;
            else {
                let left = goal.x + amr.armLen; let right = goal.x + goal.width - amr.width - amr.armLen;
                amr.x += amr.speed; if (amr.x < left || amr.x > right) amr.speed *= -1;
            }

            ctx.fillStyle = amr.color; ctx.font = "bold 16px Arial"; ctx.textAlign = "center";
            ctx.fillText(amr.name, amr.x + amr.width/2, amr.y - 30);
            ctx.fillRect(amr.x, amr.y+20, amr.width, amr.height-20);
            ctx.beginPath(); ctx.arc(amr.x + amr.width/2, amr.y, 20, 0, Math.PI*2); ctx.fill();
            ctx.fillRect(amr.x - amr.armLen, amr.y+25, amr.armLen, 14); ctx.fillRect(amr.x + amr.width, amr.y+25, amr.armLen, 14);

            ctx.textAlign = "center";
            if (currentChar === 'Ø¨ÙƒØ¬') {
                ctx.fillStyle = "#ff5722"; ctx.font = "bold 13px Arial";
                ctx.fillText("Ø£Ù†Ù…ÙŠ", 375, 335); ctx.fillText("Ø¹Ù…Ù„ Ø³ÙÙ„ÙŠ", 375, 350); ctx.fillText("Ø¨Ø§ÙƒØ³ØªÙˆØªØ§", 375, 365);
            } else {
                ctx.fillStyle = (currentChar === 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…') ? "#FFD700" : "#f1c40f";
                ctx.font = "bold 16px Arial"; ctx.fillText(currentChar, 375, 355);
            }
            ctx.fillStyle = "#ffdbac"; ctx.beginPath(); ctx.arc(375, 380, 15, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = (currentChar === 'Ø¨ÙƒØ¬' || currentChar === 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…') ? "#9b59b6" : "#2ecc71";
            ctx.fillRect(357, 395, 36, 40);

            if (ball.shooting) {
                ball.x += (ball.targetX - ball.x) * ball.speed; ball.y += (ball.targetY - ball.y) * ball.speed;
                let hit = ball.x > (amr.x - amr.armLen) && ball.x < (amr.x + amr.width + amr.armLen) && ball.y < (amr.y + amr.height + 20) && ball.y > amr.y - 20;
                
                if (isImpossibleMode && currentChar !== 'Ø¢Ø³Ø± Ø§Ù„Ø¨Ø±Ø§ÙŠÙ…' && ball.y < 250) hit = true;
                if (hit && currentChar === 'Ù†ÙˆØ±' && firstShot) hit = false;
                if (currentChar === 'Ø¨Ø¨Ø§Ø³ÙŠ' && ball.y < 250) hit = true;

                if (hit) {
                    lives--; message = "Ø§Ø¨Ù„Ø¹ØŒ ØªØ´ÙŠØ²ÙŠ Ø¹Ù…ØªÙƒ!"; messageColor = "#00d2ff";
                    messageTimer = 80; resetBall(); updateUI();
                    if (lives <= 0) { gameRunning = false; saveData(); document.getElementById('game-over').style.display='flex'; }
                } else if (ball.y <= goal.y + goal.height) {
                    if (ball.x > goal.x && ball.x < goal.x + goal.width) {
                        score += (currentChar === 'Ø¨ÙƒØ¬' ? 3 : 1);
                        coins += (currentChar === 'Ø¹ÙÙŠÙÙŠ' ? 150 : 50); 
                        updateCurrency();
                        let cd = shopItems.find(c => c.id === currentChar);
                        message = cd ? cd.catch : "Ø¬ÙˆÙˆÙˆÙˆ!"; messageColor = (currentChar.includes('Ø¢Ø³Ø±')) ? "#FFD700" : "#f1c40f"; 
                        messageTimer = 60;
                        if (!isImpossibleMode) {
                            let newLvl = Math.min(5, Math.floor(score/3) + 1);
                            if (newLvl > bossLevel) { bossLevel = newLvl; resetBoss(); }
                        }
                    }
                    firstShot = false; resetBall(); updateUI();
                }
            }
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2); ctx.fill();
            if (messageTimer > 0) { ctx.fillStyle = messageColor; ctx.font = "bold 38px Arial"; ctx.fillText(message, 375, 250); messageTimer--; }
            animationId = requestAnimationFrame(animate);
        }
        updateCurrency();
        document.getElementById('active-char-ui').innerText = (currentChar === 'Ø¨ÙƒØ¬' ? 'Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ù…Ø±Ø¹Ø¨' : currentChar);
    </script>
</body>
</html>

